<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Tabel Jadwal</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css">
</head>
<body>
    <h1>Data Jadwal Shift</h1>
    <div id="description">
        <p>Jika berhalangan hadir pada shift sesuai nomor urut, maka dapat hadir pada shift susulan: <strong>Pukul 17.00 - 18.00 WITA</strong></p>
    </div>
    <table id="dataTable">
        <thead>
            <tr>
                <th>Nomor Urut</th>
                <th>NIM</th>
                <th>NAMA</th>
                <th>Jadwal Shift</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // URL Google Sheet dalam format CSV
        const sheetID = "1dCUa-4Xh7_f_VFQS2XCke5jomrhoc4Vw";
        const sheetName = "ALL";
        const range = "A14:C819";
        const apiUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&sheet=${sheetName}&range=${range}`;

        // Ambil data dan render tabel
        $(document).ready(function () {
            $.ajax({
                url: apiUrl,
                dataType: "text",
                success: function (data) {
                    const rows = data.split("\n").slice(1); // Skip header
                    let tableRows = "";

                    rows.forEach((row, index) => {
                        const cols = row.split(",");
                        const nomorUrut = parseInt(cols[0].trim()); // Bersihkan data
                        const nim = cols[1] ? cols[1].trim() : "-";
                        const nama = cols[2] ? cols[2].trim() : "-";
                        let jadwalShift = "";

                        // Tentukan jadwal shift berdasarkan nomor urut
                        if (!isNaN(nomorUrut)) {
                            if (nomorUrut >= 201 && nomorUrut <= 400) {
                                jadwalShift = "Pukul 08.00 - 10.00 WITA";
                            } else if (nomorUrut >= 401 && nomorUrut <= 600) {
                                jadwalShift = "Pukul 10.00 - 12.00 WITA";
                            } else if (nomorUrut >= 601 && nomorUrut <= 800) {
                                jadwalShift = "Pukul 13.00 - 15.00 WITA";
                            } else if (nomorUrut >= 1 && nomorUrut <= 200) {
                                jadwalShift = "Pukul 15.00 - 17.00 WITA";
                            }

                            // Tambahkan baris ke tabel
                            tableRows += `
                                <tr>
                                    <td>${nomorUrut}</td>
                                    <td>${nim}</td>
                                    <td>${nama}</td>
                                    <td>${jadwalShift}</td>
                                </tr>
                            `;
                        }
                    });

                    $("#dataTable tbody").html(tableRows);

                    // Tambahkan fitur search dengan DataTable library
                    new simpleDatatables.DataTable("#dataTable");
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching data:", error);
                    alert("Gagal mengambil data dari Google Sheet. Pastikan URL sheet benar dan bisa diakses.");
                }
            });
        });
    </script>
</body>
</html>
